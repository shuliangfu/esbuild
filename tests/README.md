# æµ‹è¯•è¯´æ˜

## ğŸ“ æµ‹è¯•æ•°æ®ç›®å½•

**é‡è¦**ï¼šæ‰€æœ‰æµ‹è¯•è¾“å‡ºæ–‡ä»¶éƒ½å¿…é¡»æ”¾åœ¨ `tests/data/`
ç›®å½•ä¸‹ï¼Œä¸èƒ½ç”Ÿæˆåœ¨åº“çš„æ ¹ç›®å½•ã€‚

### ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ data/                    # æ‰€æœ‰æµ‹è¯•è¾“å‡ºæ–‡ä»¶ï¼ˆåœ¨ .gitignore ä¸­ï¼‰
â”‚   â”œâ”€â”€ builder/
â”‚   â”œâ”€â”€ client-builder/
â”‚   â”œâ”€â”€ server-builder/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ *.test.ts               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ test-utils.ts           # æµ‹è¯•å·¥å…·å‡½æ•°
â””â”€â”€ cleanup-after-tests.ts # æµ‹è¯•åæ¸…ç†è„šæœ¬
```

### ä½¿ç”¨æµ‹è¯•å·¥å…·å‡½æ•°

æ‰€æœ‰æµ‹è¯•éƒ½åº”è¯¥ä½¿ç”¨ `getTestOutputDir()` æ¥è·å–è¾“å‡ºç›®å½•ï¼š

```typescript
import { getTestDataDir, getTestOutputDir } from "./test-utils.ts";

// è·å–æµ‹è¯•æ•°æ®ç›®å½•
const testDataDir = getTestDataDir();

// è·å–æµ‹è¯•è¾“å‡ºç›®å½•ï¼ˆæ¨èä½¿ç”¨å­ç›®å½•åŒºåˆ†ä¸åŒæµ‹è¯•ï¼‰
const outputDir = getTestOutputDir("builder");
```

### æµ‹è¯•åæ¸…ç†

åœ¨æ¯ä¸ªæµ‹è¯•æ–‡ä»¶çš„æœ€åï¼Œåº”è¯¥æ·»åŠ æ¸…ç†æ­¥éª¤ï¼š

```typescript
// æ¸…ç†æµ‹è¯•æ–‡ä»¶
it("åº”è¯¥æ¸…ç†æµ‹è¯•æ–‡ä»¶", async () => {
  try {
    await remove(testDataDir, { recursive: true });
    await remove(outputDir, { recursive: true });
  } catch {
    // å¿½ç•¥æ¸…ç†é”™è¯¯
  }
});
```

æˆ–è€…ä½¿ç”¨ç»Ÿä¸€çš„æ¸…ç†å‡½æ•°ï¼š

```typescript
import { cleanupTestData } from "./test-utils.ts";

// åœ¨æµ‹è¯•å¥—ä»¶æœ€å
it("åº”è¯¥æ¸…ç†æµ‹è¯•æ•°æ®", async () => {
  await cleanupTestData();
});
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¾“å‡ºè·¯å¾„**ï¼šæ‰€æœ‰æµ‹è¯•å¿…é¡»ä½¿ç”¨ `getTestOutputDir()`
   è®¾ç½®è¾“å‡ºç›®å½•ï¼Œä¸èƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¦‚ `"./dist"` æˆ– `"dist"`
2. **æœåŠ¡ç«¯æ„å»º**ï¼šæœåŠ¡ç«¯æ„å»ºä¼šç”Ÿæˆ `server` æˆ– `server.js`
   æ–‡ä»¶ï¼Œå¿…é¡»ç¡®ä¿è¾“å‡ºç›®å½•åœ¨ `tests/data/` ä¸‹
3. **æ¸…ç†**ï¼šæµ‹è¯•å®Œæˆåå¿…é¡»æ¸…ç† `tests/data/` ç›®å½•ï¼Œé¿å…æ®‹ç•™æ–‡ä»¶

## ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®

è¿è¡Œæ‰€æœ‰æµ‹è¯•åï¼Œå¯ä»¥æ‰‹åŠ¨æ¸…ç†ï¼š

```bash
# æ¸…ç† esbuild åº“çš„æµ‹è¯•æ•°æ®
deno run --allow-read --allow-write tests/cleanup-after-tests.ts

# æˆ–è€…ç›´æ¥åˆ é™¤ç›®å½•
rm -rf tests/data/*
```

## ğŸ“ æµ‹è¯•è¦†ç›–èŒƒå›´

è¯¦è§å„æµ‹è¯•æ–‡ä»¶çš„æ³¨é‡Šè¯´æ˜ã€‚
